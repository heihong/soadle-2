<html lang="en">
<head>
<meta charset="utf-8">
<title>Soadle</title>
</head>

<div class="container" style="margin: 0 auto; margin-top: 10px; width: 100%;">
	<table width="100%">
		<tr>
			<TD align="center" width="40%"><img src="/assets/images/logo.png" /></TD>
			<TD width="20%">
				<!-- Login panel -->
				<div class=" col-md-4 col-md-offset-4" style="width: 350px;">
					<div class="panel panel-default" *ngIf="!resulUser">
						<div class="panel-heading">Bienvenue à Soadle</div>
						<div class="panel-body">
							<div class="col-md-12">
								<a class="btn btn-default" href="/google/login">Google Login</a>
							</div>
						</div>
					</div>
					<!-- End Login panel -->

					<!-- Home panel.It will visible after successfull login -->
					<div class="panel panel-default" *ngIf="resulUser">
						<div class="panel-heading">
							<img class="p-img" alt="" src="{{resulUser.userAuthentication.details.picture}}"> Name: {{resulUser.name}}
						</div>
						<div class="panel-body">
							<div class="col-md-12">Email: {{resulUser.userAuthentication.details.email}}</div>							
							<div class="col-md-12"><a href="#" class="btn_small btn-default margin-top-5" (click)="logout()"> Logout</a></div>
						</div>
					</div>
					<!-- End Home Panel -->
				</div>
			</TD>
			<TD align="center" width="40%"><img src="/assets/images/logo.png" /></TD>
		</tr>
	</table>
</div>


<div class="container" style="margin: 0 auto; margin-top: 1px;">
	<div class="panel panel-hello" *ngIf="resulUser">
		<div style="border: 1px solid #b8dc6f;">
			<table width="100%">
				<tr>
				    <th width="80%"></th>
					<th width="20%"></th>
				</tr>
				<tbody>
					<tr>
						<TD align="left">
						    <button class="btn btn-default" (click)="getList(idListTags.value.trim())">Liste des evènements</button>&nbsp;
						     Titre/Tags : <input #idListTags placeholder="idListTags" required value=" " style="background-color: #b8dc6f; height: 30px; width: 200px;">&nbsp;&nbsp;
							<button class="btn btn-default" (click)="getMeeting(id.value)">Afficher un meeting</button>&nbsp;<input #id placeholder="" required value="{{result.id || ' '}}" style="background-color: #b8dc6f; height: 30px; width: 200px;">&nbsp;		
							<button class="btn btn-default" (click)="importDoodle(id.value)" *ngIf="result && result.origine == 'D' && result.doodleReference == null">Importer le doodle</button>
							<button class="btn btn-default" (click)="importDoodle(id.value)" *ngIf="result && result.origine == 'D' && result.doodleReference != null">Re-Importer le doodle</button>					
						</TD>
						<TD align="right">
							<button class="btn btn-default" (click)="create(1)" *ngIf="!indCreate" >Créer un soadle</button>&nbsp;	
							<button class="btn btn-default" (click)="create(2)" *ngIf="!indCreate" >Créer un doodle</button>
						</TD>
					</tr>
				</tbody>
			</table>
		</div>
		
		<div style="padding: 3px; margin-top: 3px; border: 2px solid #b8dc6f;" *ngIf="indCreate">
			<table>
				<tr>
					<th width="30%"></th>
					<th width="40%"></th>
					<th width="30%"></th>
				</tr>
				<tbody>
					<tr>
						<td><b>Titre de l'evenement :</b></td>
						<td><input #idTitle placeholder="idTitle" required value=" " style="background-color: #b8dc6f; height: 30px; width: 300px;"></td>
						<td align="right">						
						</td>
					</tr>
					<tr>
						<td><b>Description de l'evenement :</b></td>
						<td><input #idDescription placeholder="idDescription" required value=" " style="background-color: #b8dc6f; height: 30px; width: 300px;"></td>
                        <td></td>
					</tr>
					<tr>
						<td><b>Date de l'evenement :</b></td>
						<td><input #idDate placeholder="idDate" type="date" required value=" " style="background-color: #b8dc6f; height: 30px; width: 120px;"> Heure : <input #idHeure placeholder="idHeure" type="time" required value=" " style="background-color: #b8dc6f; height: 30px; width: 60px;"></td>
					    <td></td>
					</tr>
					<tr>
						<td><b>Lieu de l'evenement :</b></td>
						<td><input #idName placeholder="idName" required value=" " style="background-color: #b8dc6f; height: 30px; width: 300px;"></td>
					    <td></td>
					</tr>
					<tr>
						<td><b>Adresse de lieu de l'evenement :</b></td>
						<td><input #idAdress placeholder="idAdress" required value=" " style="background-color: #b8dc6f; height: 30px; width: 400px;"></td>
					    <td></td>
					</tr>			
					<tr>
						<td><b>Tags :</b></td>
						<td><input #idTags placeholder="" required value=" " style="background-color: #b8dc6f; height: 30px; width: 400px;"></td>
					</tr>		
					<tr>
					    <td></td>
					    <td align="left"><div *ngIf="indCreate==1"><button class="btn btn-default"  (click)="crateEventSoadle(idTitle.value, idDescription.value, idDate.value + ' ' + idHeure.value, idName.value, idAdress.value, idTags.value); id.value=' '" >Enregistrer soadle</button>&nbsp;<button class="btn btn-default" (click)="getList()">Annuler</button></div>
						                 <div *ngIf="indCreate==2"><button class="btn btn-default"  (click)="crateEventDoodle(idTitle.value, idDescription.value, idDate.value + ' ' + idHeure.value, idName.value, idAdress.value, idTags.value); id.value=' '" >Enregistrer doodle</button>&nbsp;<button class="btn btn-default" (click)="getList()">Annuler</button></div>						                 
					    </td>
					<td></td>
					</tr>
				</tbody>
			</table>
		</div>

		<div style="padding: 3px; margin-top: 3px; border: 2px solid #b8dc6f;" *ngIf="result" width="100%">
			<table width="100%">
				<tr>
					<th width="20%"></th>
					<th width="50%"></th>
					<th width="30%"></th>
				</tr>
				<tbody>
					<tr>
						<td><b>Titre de l'evenement :</b></td>
						<td *ngIf="result.origine == 'D'">
						    <a href="https://doodle.com/poll/{{result.id}}" target=_blank>{{result.title}}</a>						    
						</td>
						<td *ngIf="result.origine != 'D'">
						    {{result.title}}					    
						</td>
					</tr>
					<tr>
						<td><b>Description de l'evenement :</b></td>
						<td>{{result.description}}</td>
						<TD></TD>
					</tr>
					<tr>
						<td><b>Date de l'evenement :</b></td>
						<td>{{result.options[0].date  | date: 'dd/MM/yyyy hh:mm'}}</td>
						<TD></TD>
					</tr>
					<tr *ngIf="result.initiator">
						<td><b>Initiateur de l'evenement :</b></td>
						<td>{{result.initiator.name}}</td>
						<TD></TD>
					</tr>
					<tr>
						<td><b>Lieu de l'evenement :</b></td>
						<td><a href="https://www.google.fr/maps/place/{{result.location.name}} {{result.location.address}}" target=_blank> {{result.location.name}} {{result.location.address}} </a></td>
						<TD></TD>
					</tr>
					<tr>
						<td><b>Nombre de participant :</b></td>
						<td>{{result.participantsCount}}</td>
						<TD></TD>
					</tr>
					<tr>
						<td><b>Tags :</b></td>
						<td *ngIf="!indModif && (result.origine == 'S' ||  result.doodleReference != null )" >
						   <a href="#" (click)="modificationMeeting(result.id, result.origine)" >{{result.tags || 'ajouter des tags'}}</a>
						</td>
						<td *ngIf="!indModif && (result.origine == 'D' &&  result.doodleReference == null )" >
						   {{result.tags}} 				 
						</td>
						<td *ngIf="indModif" >						
						     <input #idTags1 placeholder="idTags1" required value="{{result.tags}}" style="background-color: #b8dc6f; height: 30px; width: 400px;">
						     <button class="btn_small btn-default"  (click)="saveMeeting(result.id, idTags1.value)" >Enregistrer</button>&nbsp;
						     <button class="btn_small btn-default"  (click)="annulModif()" >Annuler</button>
						</td>
						<TD align="right">
						    <button *ngIf="existMailNam(result , resulUser.name, resulUser.userAuthentication.details.email) <= 0" class="btn_small btn-default"  (click)="participe(true , result.id, result.origine, resulUser.name, resulUser.userAuthentication.details.email)" >Je participe</button>&nbsp;
						    <button *ngIf="existMailNam(result , resulUser.name, resulUser.userAuthentication.details.email) == 0" class="btn_small btn-default"  (click)="participe(false , result.id, result.origine, resulUser.name, resulUser.userAuthentication.details.email)" >Je ne participe pas</button>
						    <button *ngIf="existMailNam(result , resulUser.name, resulUser.userAuthentication.details.email) == 1" class="btn_small btn-default"  (click)="participe(false , result.id, result.origine, resulUser.name, resulUser.userAuthentication.details.email)" >Je ne participe plus</button>					
						</TD>
					</tr>
				</tbody>
			</table>
		</div>
		<div style="height: 370px; overflow-y: auto; overflow-x: hidden;" *ngIf="result">
			<table class="table">
				<thead>
					<tr>
						<th class="col" style="width: 5%;">#</th>
						<th class="col" style="width: 5%;"></th>
						<th class="col" style="width: 75%;">Participant</th>
						<th class="col" style="width: 15%;">Preference</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let participant of result.participants; let idx = index" [ngStyle]="{'backgroundColor': participant.preference == true ? '#b8dc6f' : '#ffc0cb' }">
						<td class="col">{{idx}}</td>
						<td class="col" align="right"><img class="p-img-tab" alt="" src="{{participant.smallAvatarUrl}}"></td>
						<td class="col">{{participant.name}}</td>
						<td class="col"><INPUT type="checkbox" name="choix{{idx}}" [checked]="participant.preference" disabled></td>
					</tr>
				</tbody>
			</table>
		</div>

		<div style="height: 370px; overflow-y: auto; overflow-x: hidden;" *ngIf="resultList">
			<table class="table">
				<thead>
					<tr>
						<th class="col" style="width: 13%;">Titre</th>
						<th class="col" style="width: 25%;">Lieu</th>
						<th class="col" style="width: 10%;">Date</th>
						<th class="col" style="width: 13%;">Initiateur</th>
						<th class="col" style="width: 5%;">Nb par.</th>
						<th class="col" style="width: 5%;">Origine</th>
						<th class="col" style="width: 20%;">Tags</th>
						<th class="col" style="width: 9%;"></th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let meeting of resultList; let idx = index" [ngStyle]="{'backgroundColor': idx % 2 == 0 ? '#b8dc6f' : '#cce698' }">						
						<td class="col" >
						    <a href="#" (click)="getDoodle(meeting.id)" *ngIf="meeting.origine == 'D'">{{meeting.title}}</a>
						    <a href="#" (click)="getSoadle(meeting.id)" *ngIf="meeting.origine != 'D'">{{meeting.title}}</a>
						</td>
						<td class="col"><a href="https://www.google.fr/maps/place/{{meeting.location.name}} {{meeting.location.address}}" target=_blank>{{meeting.location.name}}</a></td>
						<td class="col">{{meeting.options[0].date | date: 'dd/MM/yyyy hh:mm'}}</td>
						<td class="col"><div *ngIf="meeting.initiator">{{meeting.initiator.name}}</div></td>
						<td class="col">{{meeting.participantsCount}}</td>
						<td class="col">
							<div *ngIf="meeting.origine == 'D'">
								<a href="https://doodle.com/poll/{{meeting.id}}" target=_blank><b>Doodle</b></a>
							</div>
							<div *ngIf="meeting.origine == 'S'">
								<b>Soadle</b>
							</div>
						</td>
						<td class="col">{{meeting.tags}}</td>
						<td class="col" align="right">
							<button class="btn_small btn-default" (click)="delete(meeting.id, meeting.origine)"  style="color: #FF0000;">Supprimer</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>
</div>